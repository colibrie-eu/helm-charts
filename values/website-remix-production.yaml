image:
  tag: 0.2.3
ingress:
  enabled: true
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/server-snippet: |
      set $redirect 0;
      set $redirect_target "";

      if ($host = "www.colibrie.eu") {
        set $redirect 1;
        set $redirect_target "https://colibrie.eu$request_uri";
      }
      if ($host = "wattwise.at") {
        set $redirect 1;
        set $redirect_target "https://colibrie.eu$request_uri";
      }
      if ($host = "www.wattwise.at") {
        set $redirect 1;
        set $redirect_target "https://colibrie.eu$request_uri";
      }

      if ($request_uri ~ ^/.well-known/acme-challenge/) {
        set $redirect 0;
      }

      if ($redirect = 1) {
        return 301 $redirect_target;
      }
  className: nginx
  hosts:
    - host: colibrie.eu
      paths:
        - path: /
          pathType: ImplementationSpecific
    - host: www.colibrie.eu
      paths:
        - path: /
          pathType: ImplementationSpecific
    - host: wattwise.at
      paths:
        - path: /
          pathType: ImplementationSpecific
    - host: www.wattwise.at
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls:
    - secretName: colibrie.eu-tls
      hosts:
        - colibrie.eu
        - www.colibrie.eu
        - wattwise.at
        - www.wattwise.at
livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 15
  timeoutSeconds: 5
  failureThreshold: 5
readinessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 15
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
resources:
  requests:
    cpu: "10m"
    memory: "96Mi"
  limits:
    cpu: "100m"
    memory: "192Mi"
